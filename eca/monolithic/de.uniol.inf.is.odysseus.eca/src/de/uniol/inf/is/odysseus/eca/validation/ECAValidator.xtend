/*
 * generated by Xtext
 */
package de.uniol.inf.is.odysseus.eca.validation

import de.uniol.inf.is.odysseus.eca.eCA.COMMANDACTION
import org.eclipse.xtext.validation.Check
import de.uniol.inf.is.odysseus.eca.eCA.ECAPackage

/**
 * This class contains custom validation rules. 
 * 
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#validation
 */
class ECAValidator extends AbstractECAValidator {

	public static val INVALID_START = 'State invalid for startQuery'
	public static val INVALID_STOP = 'State invalid for stopQuery'

	@Check
	def checkState(COMMANDACTION act) {

		var String actName;
		var String actState;

		if (act.subActname !== null) {
			actName = act.subActname;
		}
		if (act.functAction.stateName !== null) {
			actState = act.functAction.stateName;
		}
		if (act.functAction.stateName !== null && actName !== null && actState !== null) {

			if ((actName.equals("startQuery")) && !(actState.equals("INACTIVE"))) {
				error(
					'Cannot start Query if state = ' + act.functAction.stateName + '!',
					ECAPackage.Literals.COMMANDACTION__FUNCT_ACTION,
					INVALID_START
				)
			} else if ((actName.equals("stopQuery")) && !(actState.equals("RUNNING") || actState.equals("PARTIAL"))) {
				error(
					'Cannot stop Query if state = ' + act.functAction.stateName + '!',
					ECAPackage.Literals.COMMANDACTION__FUNCT_ACTION,
					INVALID_STOP
				)
			} else if ((actName.equals("suspendQuery")) &&
				!(actState.equals("RUNNING") || actState.equals("PARTIAL"))) {
				error('Cannot suspend Query if state = ' + act.functAction.stateName + '!', act,
					ECAPackage.Literals.COMMANDACTION__FUNCT_ACTION)
			} else if ((actName.equals("resumeQuery")) &&
				!(actState.equals("SUSPENDED") || actState.equals("PARTIAL_SUSPENDED"))) {
				error('Cannot resume Query if state = ' + act.functAction.stateName + '!', act,
					ECAPackage.Literals.COMMANDACTION__FUNCT_ACTION)
			} else if ((actName.equals("fullQuery")) &&
				!(actState.equals("PARTIAL") || actState.equals("PARTIAL_SUSPENDED"))) {
				error('Cannot set Query full if state = ' + act.functAction.stateName + '!', act,
					ECAPackage.Literals.COMMANDACTION__FUNCT_ACTION)
			} else if ((actName.equals("partialQuery")) &&
				!(actState.equals("INACTIVE") || actState.equals("RUNNING") || actState.equals("SUSPENDED"))) {
				error('Cannot set Query partial if state = ' + act.functAction.stateName + '!', act,
					ECAPackage.Literals.COMMANDACTION__FUNCT_ACTION)
			}
		}
	}
}
